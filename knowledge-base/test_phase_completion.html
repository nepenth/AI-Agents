<!DOCTYPE html>
<html>
<head>
    <title>Phase Completion Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 10px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Phase Completion Test</h1>
    
    <div class="test-section">
        <h2>Test Phase Completion Events</h2>
        <button onclick="testPhaseCompletion()">Test Phase Completion with Counts</button>
        <button onclick="testPhaseSkipped()">Test Phase Skipped</button>
        <button onclick="testPhaseError()">Test Phase Error</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>
    
    <div class="test-section">
        <h2>Event Log</h2>
        <div id="event-log" class="log"></div>
    </div>

    <script>
        // Mock execution plan manager for testing
        const mockPhases = {
            'tweet_caching': { statusElement: { textContent: '', dataset: {} } },
            'media_analysis': { statusElement: { textContent: '', dataset: {} } },
            'llm_processing': { statusElement: { textContent: '', dataset: {} } }
        };

        function log(message) {
            const logDiv = document.getElementById('event-log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function testPhaseCompletion() {
            log('Testing phase completion with counts...');
            
            // Simulate phase completion event with counts
            const event = new CustomEvent('phase_complete', {
                detail: {
                    phase_name: 'tweet_caching',
                    result: {
                        processed_count: 15,
                        total_count: 20,
                        skipped_count: 5
                    }
                }
            });
            
            document.dispatchEvent(event);
            log('Dispatched phase_complete event for tweet_caching');
        }

        function testPhaseSkipped() {
            log('Testing phase skipped...');
            
            const event = new CustomEvent('phase_update', {
                detail: {
                    phase_id: 'media_analysis',
                    status: 'completed',
                    message: 'All items already processed',
                    processed_count: 0,
                    total_count: 10,
                    skipped_count: 10
                }
            });
            
            document.dispatchEvent(event);
            log('Dispatched phase_update event for media_analysis (skipped)');
        }

        function testPhaseError() {
            log('Testing phase error...');
            
            const event = new CustomEvent('phase_error', {
                detail: {
                    phase_name: 'llm_processing',
                    error: 'Connection timeout'
                }
            });
            
            document.dispatchEvent(event);
            log('Dispatched phase_error event for llm_processing');
        }

        function clearLogs() {
            document.getElementById('event-log').innerHTML = '';
        }

        // Listen for events and log them
        document.addEventListener('phase_update', (event) => {
            log('Received phase_update: ' + JSON.stringify(event.detail, null, 2));
        });

        document.addEventListener('phase_complete', (event) => {
            log('Received phase_complete: ' + JSON.stringify(event.detail, null, 2));
        });

        document.addEventListener('phase_error', (event) => {
            log('Received phase_error: ' + JSON.stringify(event.detail, null, 2));
        });

        log('Phase completion test page loaded');
    </script>
</body>
</html>